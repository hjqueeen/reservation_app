# Dockerfile for development environment
FROM node:24.13.0-alpine

WORKDIR /app

# Configuration for package manager cache
RUN apk add --no-cache libc6-compat

# Copy package.json
COPY package.json ./

# Install dependencies
RUN npm install

# Source code is mounted as volume in docker-compose, so not copied here

EXPOSE 3002

ENV PORT=3002
ENV HOSTNAME="0.0.0.0"

# Create entrypoint script
RUN echo '#!/bin/sh' > /entrypoint.sh && \
    echo 'if [ ! -d "node_modules" ] || [ -z "$(ls -A node_modules)" ]; then' >> /entrypoint.sh && \
    echo '  echo "Installing dependencies..."' >> /entrypoint.sh && \
    echo '  npm install' >> /entrypoint.sh && \
    echo 'fi' >> /entrypoint.sh && \
    echo 'exec "$@"' >> /entrypoint.sh && \
    chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]

# Run development server
CMD ["npm", "run", "dev"]
